# Testsight ‚Äî üéØ —É–º–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

Testsight –ø–æ–º–æ–≥–∞–µ—Ç CI –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä—ã–º–∏: –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç Python-–ø—Ä–æ–µ–∫—Ç, –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ –∏ —Ç–µ—Å—Ç–∞–º–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ pytest-–º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫–∞—Å–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

```
üöÄ Git diff ‚Üí üß† –ê–Ω–∞–ª–∏–∑ –∏–º–ø–æ—Ä—Ç–∞ ‚Üí üéØ –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ ‚Üí ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ CI –ø—Ä–æ–≥–æ–Ω
```

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- üß≠ **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**: —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤–ø–ª–æ—Ç—å –¥–æ —É—Ä–æ–≤–Ω—è —Å–∏–º–≤–æ–ª–æ–≤, –∏–∑–±–µ–≥–∞—è –ª–∞–≤–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤.
- ü™Ñ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π fallback**: –µ—Å–ª–∏ –∏–º–ø–æ—Ä—Ç –Ω–∞–π—Ç–∏ —Å–ª–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –ø–∞–ø–æ–∫, —á—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–∞–º—ã–µ –±–ª–∏–∑–∫–∏–µ —Ç–µ—Å—Ç—ã.
- üß± **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: CLI, TOML –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —Å—Ç—Ä–∞—Ç–µ–≥–∏—é `git diff`, –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤, –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞.
- üß™ **20 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å `git add`**: –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä pytest-–∫–µ–π—Å–æ–≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–µ–¥–µ—Ç —Å–µ–±—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö.
- üß∞ **Zero hardcode**: –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–∏–≤—è–∑–æ–∫ –∫ `poetry` –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äû–∏–∑ –∫–æ—Ä–æ–±–∫–∏‚Äú, –Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
poetry install        # –∏–ª–∏ python3.10 -m venv .venv && .venv/bin/pip install -e .
poetry run testsight  # –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ git-–∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç pytest
```

### –ü—Ä–∏–º–µ—Ä CLI
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞
poetry run testsight --dry-run

# –ü–æ–ª—É—á–∏—Ç—å JSON ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ CI
poetry run testsight --json

# –ö–∞—Å—Ç–æ–º–Ω—ã–π diff (–¥–∏–∞–ø–∞–∑–æ–Ω –∫–æ–º–º–∏—Ç–æ–≤)
poetry run testsight --diff-mode range --base main --head HEAD

# –°–≤–æ–π –∫–æ–º–∞–Ω–¥–Ω—ã–π —Ä–∞–Ω–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ tox)
poetry run testsight --test-command "tox -e py310 --"
```

## üß© –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
1. **–î–æ–±–∞–≤—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.**
   - PyPI (–ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞): `poetry add testsight` –∏–ª–∏ `pip install testsight`.
   - –ü—Ä—è–º–æ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:  
     ```bash
     poetry add --git https://github.com/loobinsk/testsight.git
     # –∏–ª–∏ pip install git+https://github.com/loobinsk/testsight.git
     ```
2. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥.** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª–æ–∂–∏—Ç–µ `testsight.toml` –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ü–∏—é –≤ `pyproject.toml`:
   ```toml
   [tool.testsight]
   test-command = "pytest -q --maxfail=1"
   dry-run = false

   [tool.testsight.diff]
   mode = "staged"
   include-untracked = true
   ```
3. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ Testsight:** `poetry run testsight` (–∏–ª–∏ `testsight` –∏–∑ –≤–∞—à–µ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è).

### üîÅ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ pre-commit
–î–æ–±–∞–≤—å—Ç–µ —Ö—É–∫–∏, —á—Ç–æ–±—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–∏—Ç—ã –±–µ–∑ –ø—Ä–æ–≥–æ–Ω–æ–≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: testsight
        name: testsight (impacted tests)
        entry: poetry run testsight
        language: system
        pass_filenames: false
```

> –•—É–∫ —Ä–∞—Å–ø–µ—á–∞—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤–∞—à `test-command`. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å `dry-run`, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫—É –±–µ–∑ –∑–∞–ø—É—Å–∫–∞.

### ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI
```yaml
# GitHub Actions
- name: Impacted tests
  run: |
    poetry install
    poetry run testsight --json > impacted.json
    jq '.[]' impacted.json
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
Testsight –∏—â–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `testsight.toml`, `.testsightrc` –∏–ª–∏ `pyproject.toml` (`[tool.testsight]`). –í—Å—ë –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑ CLI –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`TESTSIGHT_*`).

```toml
[testsight]
root = "."
test-command = "poetry run pytest -q"
dry-run = false

[testsight.diff]
mode = "staged"          # staged | unstaged | range | custom
include-untracked = true

[testsight.naming]
directory-markers = ["tests", "e2e"]
filename-prefixes = ["test_", "spec_"]
filename-suffixes = ["_test.py", "_spec.py"]

[testsight.tokens]
minimum-length = 3
fallback-score = 8
stopwords = ["common", "shared"]
```

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `testsight.config` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ —Ä–∞–±–æ—Ç–∞ —Å CLI/TOML.
- `testsight.indexer` ‚Äî –æ–±—Ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –º–æ–¥—É–ª–µ–π.
- `testsight.resolver` ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ (BFS + —Ç–æ–∫–µ–Ω—ã).
- `testsight.runner` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å git, –∑–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥, –ø—É–±–ª–∏—á–Ω–æ–µ API.
- `testsight.cli` ‚Äî —á–µ–ª–æ–≤–µ–∫–æ-–ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∑–¥–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ: –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ CPU-bound (–ø–∞—Ä—Å–∏–Ω–≥ AST) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ–¥–∏–Ω–∏—á–Ω—ã–º–∏ –ø—Ä–æ—Ö–æ–¥–∞–º–∏. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `asyncio` —É—Å–ª–æ–∂–Ω–∏–ª–æ –±—ã API, –Ω–µ –¥–∞–≤ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–∏–≥—Ä–∞—à–∞.

## üß™ –¢–µ—Å—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã
–ö–æ–º–∞–Ω–¥–∞ –ø–æ–∫—Ä—ã—Ç–∞ 20 –∫–æ–∂—É—Ö–∞–º–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ `git add`, `git commit` –∏ –≤—ã–∑–æ–≤–∞–º–∏ CLI ‚Äî —Å–º. –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `tests/`.

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ: —Å–æ–∑–¥–∞—ë–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ 3.10 –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
python3.10 -m venv .venv
source .venv/bin/activate
pip install -r <(poetry export --without-hashes)
PYTHONPATH=src pytest -q
```

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç ‚Äî —ç—Ç–æ –≥–æ—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: –æ—Ç unit-–ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å `ChangeDetector`.

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `poetry run testsight --help` ‚Äî –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø—Ü–∏–π CLI.
- `poetry run testsight --config ./ci/testsight.toml --json` ‚Äî –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CI.
- `poetry run testsight path/to/file.py` ‚Äî –≤—Ä—É—á–Ω—É—é —É–∫–∞–∑–∞—Ç—å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

## ü§ù –í–∫–ª–∞–¥
1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `Testsight`.
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É feature/awesome-idea.
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `pytest` –∑–µ–ª—ë–Ω—ã–π (`poetry run pytest`).
4. –û—Ç–∫—Ä–æ–π—Ç–µ PR ‚Äî —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—ã —É—Å–∫–æ—Ä–∏–ª–∏.

–ë—É–¥—É —Ä–∞–¥ –ª—é–±—ã–º –∏–¥–µ—è–º: –æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–∏—Ñ—Ñ–∞ –¥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å GitHub Actions üöÄ

‚Äî Danil & Testsight community
